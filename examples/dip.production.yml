# This file is used to override or extend the main dip.yml configuration for production environments

environment:
  RAILS_ENV: production
  NODE_ENV: production
  DATABASE_URL: postgres://prod_user:prod_password@prod-db.example.com:5432/myapp_production
  REDIS_URL: redis://prod-redis.example.com:6379/0

compose:
  files:
    - docker-compose.production.yml
  project_name: myapp_production

interaction:
  # Override or add production-specific commands
  rails:
    environment:
      RAILS_LOG_TO_STDOUT: "true"
      RAILS_SERVE_STATIC_FILES: "true"
    compose:
      profiles:
        - production

  # Production-specific commands
  db_backup:
    description: Backup the production database
    service: db
    command: pg_dump -h prod-db.example.com -U prod_user myapp_production > backup.sql
    environment:
      PGPASSWORD: prod_password

  logs:
    description: View production logs
    service: web
    command: tail -f log/production.log

  deploy:
    description: Deploy to production
    command: ansible-playbook -i production deploy.yml

provision:
  - dip rails db:migrate
  - dip rails assets:precompile

kubectl:
  namespace: myapp-production

infra:
  redis:
    git: https://github.com/mycompany/redis-config.git
    ref: production
